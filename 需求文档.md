# FlipHTML5 下载扩展 - 需求文档

## 1. 项目简介
一个 Chrome 浏览器扩展，通过自动扫描 fliphtml5.com、online.fliphtml5.com 等在线电子书网站，将电子书保存为 PDF 文件下载到本地。

## 2. 核心功能

### 2.1 用户认证与付费
- **登录方式**：Google 第三方授权登录
- **付费模式**：
  - 一次性买断：3.99元（永久使用）
  - 订阅制：月付/年付（待定价格）
- **免费版限制**：PDF 每页添加 "DEMO" 水印（黑色，80%透明度，居中显示）
- **付费版权益**：无水印导出

### 2.2 扫描电子书页面
- **自动翻页扫描**：自动遍历电子书所有页面
- **图片提取**：提取每页的高清图片资源
- **扫描速度调节**：可自定义扫描间隔时间（毫秒）
- **扫描控制**：
  - 实时进度显示（当前页码/总页数）
  - 停止/暂停扫描
- **图片预览**：实时显示已扫描到的图片，每行4张缩略图，垂直滚动排列

### 2.3 生成与下载 PDF
- **PDF 版式选择**：
  - 竖版（纵向 Portrait）
  - 横版（横向 Landscape）
  - 正方版（正方形）
- **单页排版**：每页一张图片
- **水印处理**：
  - 免费版：每页中心添加 "DEMO" 水印（黑色，80%透明度）
  - 付费版：无水印
- **文件下载**：自动生成并下载 PDF 文件
- **文件命名**：根据电子书标题或 URL 自动命名

## 3. 用户界面

### 3.1 扩展 Popup 窗口
点击浏览器扩展图标弹出，包含两个 Tab 页：

#### Tab 1: 扫描控制
- **Start Scan 按钮**：启动扫描（在页面上注入对话框）
- **扫描速度设置**：调节扫描间隔时间（单位：毫秒）

#### Tab 2: 账户与付费
- **未登录状态**：
  - Google 登录按钮
  - 注册入口（跳转 Google 授权）
- **已登录状态**：
  - 显示用户信息
  - 显示当前付费状态（免费版 / 已激活 + 到期时间）
  - 付费套餐说明
  - 付费/续费入口

### 3.2 页面注入对话框
点击 Start Scan 后，在 fliphtml5 页面上居中弹出（不可拖动、不可关闭）：

#### 对话框内容
- **付费状态显示**：显示当前是免费版还是付费版
- **扫描设置区**：
  - 扫描速度调节（同步 Popup 设置）
  - PDF 版式选择：竖版 / 横版 / 正方版（单选）
- **控制按钮区**：
  - 开始扫描按钮
  - 停止/暂停按钮
- **进度显示区**：
  - 当前扫描页码
  - 预计总页数（如可获取）
  - 进度条
  - 扫描状态文本（"扫描中..." / "扫描完成"）
- **图片预览区**：
  - 实时显示已扫描到的图片缩略图
  - 每行显示 4 张图片
  - 垂直滚动排列
  - 自动滚动到最新扫描的图片
- **下载按钮**：扫描完成后可点击，生成并下载 PDF

## 4. 使用流程

### 4.1 首次使用流程
1. 用户访问 fliphtml5.com 或 online.fliphtml5.com 的电子书页面
2. 点击浏览器工具栏的扩展图标
3. 在 Popup 窗口的 Tab 2 中点击 Google 登录
4. 完成 Google 授权登录
5. （可选）查看付费套餐并完成付费
6. 切换到 Tab 1，设置扫描速度
7. 点击 "Start Scan" 按钮

### 4.2 扫描与下载流程
1. 页面上居中弹出扫描对话框
2. 在对话框中：
   - 查看当前付费状态
   - 选择 PDF 版式（竖版/横版/正方版）
   - 调整扫描速度（可选）
3. 点击"开始扫描"按钮
4. 扫描过程中：
   - 页面自动翻页
   - 对话框实时显示扫描进度
   - 图片预览区实时显示已扫描的图片（每行4张）
   - 可随时点击"停止"按钮中断
5. 扫描完成后：
   - 显示"扫描完成"提示
   - 查看所有已扫描的图片预览
   - 点击"下载 PDF"按钮
   - 自动生成 PDF 并下载到本地
   - 免费版 PDF 每页带 "DEMO" 水印
   - 付费版 PDF 无水印

### 4.3 付费升级流程
1. 在 Popup 的 Tab 2 中查看付费套餐
2. 选择购买方式（一次性买断 / 订阅制）
3. 完成支付（3.99元起）
4. 账户状态自动更新为"已激活"
5. 后续下载的 PDF 将不再带水印

## 5. 支持网站
- fliphtml5.com
- online.fliphtml5.com
- 其他基于 FlipHTML5 平台的电子书网站

## 6. 注意事项

### 6.1 使用限制
- 仅支持 Chrome 浏览器（基于 Manifest V3）
- 需要访问目标网站时才能使用扫描功能
- 扫描速度过快可能导致部分图片加载失败，建议使用默认速度
- 页面结构发生变化可能导致扫描失败

### 6.2 付费相关
- 免费版功能完整，仅 PDF 导出带 "DEMO" 水印
- 付费后立即生效，无需重启扩展
- 一次性买断为永久授权
- 订阅制到期后自动恢复为免费版（带水印）
- 付费信息与 Google 账号绑定，更换设备登录同一账号即可使用

### 6.3 常见问题
- **扫描不完整**：尝试降低扫描速度，增加页面加载时间
- **下载的 PDF 空白**：检查网络连接，确保图片正常加载
- **无法启动扫描**：确认当前页面为支持的电子书网站
- **登录失败**：检查 Google 账号授权，允许扩展访问基本信息
- **水印无法去除**：确认已完成付费且账户状态为"已激活"

### 6.4 技术说明
- PDF 生成库：jsPDF
- 后端服务：Supabase（用户认证与付费状态管理）
- 数据存储：Chrome Storage API（本地设置缓存）

## 7. 待确定项

### 7.1 Supabase 后端配置
- [x] 已完成配置，直接使用现有设置

### 7.2 用户登录（暂不实现真实认证）
- **UI 呈现**：显示"登录"按钮
- **点击效果**：按钮变为显示用户名（模拟登录状态）
- **Google OAuth 集成**：后期再接入真实的 Google 认证

### 7.3 支付显示（暂不实现支付功能）
- **显示价格**：
  - 月付：$3.99/月
  - 年付：$19.99/年
- **UI 呈现**：显示支付按钮，点击效果暂不实现
- **支付集成**：后期再接入真实支付平台

### 7.4 UI/UX 设计参数（使用 Ant Design 规范）
- [x] **扫描对话框尺寸**：
  - 宽度：800px
  - 最大高度：80vh（屏幕高度的80%，自适应）
  - 图片预览区：固定高度 400px，内部可滚动
- [x] **缩略图尺寸**：每张 180px 宽度，高度自适应保持比例，间距 16px
- [x] **颜色主题**（Ant Design 默认）：
  - 主色调：#1890ff（蓝色）
  - 成功色：#52c41a（绿色）
  - 警告色：#faad14（橙色）
  - 背景色：#ffffff
  - 边框色：#d9d9d9
- [x] **字体**：使用 Ant Design 默认字体栈（系统字体）
- [x] **组件库**：Ant Design 6.2.3（已安装）

### 7.5 业务逻辑参数
- [x] **扫描速度设置**：
  - 默认值：1000ms
  - 可调范围：500ms - 3000ms
  - UI 控件：滑块（Ant Design Slider 组件）
- [x] **扫描结束判断**：
  - 用户手动点击停止
  - 达到最大页面且所有图片都缓存完成
  - 500页上限（防止意外无限循环）
- [x] **PDF 页面尺寸**：
  - 竖版：A4 纵向（210mm × 297mm）
  - 横版：A4 横向（297mm × 210mm）
  - 正方版：正方形（210mm × 210mm）

### 7.6 水印设计细节
- [x] **字体**：系统默认字体
- [x] **字号**：72px
- [x] **旋转角度**：对角线斜向（-45度）
- [x] **位置**：页面居中
- [x] **颜色**：黑色 #000000
- [x] **透明度**：80%
- [x] **水印文本**：DEMO

### 7.7 错误处理与监控
- [x] 暂不实现，后期根据需要再添加
